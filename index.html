<!DOCTYPE html>

</html>

<head>
  <title>svift_v1</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="styles/app/normalize.css">
  <link rel="stylesheet" href="styles/app/app.css">
  <link rel="stylesheet" href="styles/bot/bot.css">
  <link href="https://fonts.googleapis.com/css?family=Merriweather|Poppins|Roboto+Mono" rel="stylesheet">

  <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
  <link rel="manifest" href="favicon/manifest.json">
  <link rel="mask-icon" href="favicon/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="shortcut icon" href="favicon/favicon.ico">
  <meta name="msapplication-config" content="favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
</head>

<body>

  <div class="app">
    <div id="gui-1" class="gui">
      <div id="gui-1-overlay"></div>
      <nav>
        <div></div>
        <div></div>
        <div></div>
      </nav>
      <!-- <div id="nav">
      <ul>
        <li>Home | Build a vis</li>
        <li>About</li>
        <li>Dev / Docs</li>
        <li>Contact / Legal Note</li>
        <li>Pro<li>
      </ul>
    </div> -->
      <div class="inner">
        <img class="img-logo" src="assets/img/wordmark-white.png" alt="Svift Logo">
        <h1>Simply make your numbers look good</h1>
        <div class="claim">
          <em>svift</em> is an open source tool to turn your numbers into beautiful charts - in no time.
          <em>svift</em> is currently in private beta. Try our prototype now and let us know what you think!
        </div>
        <div class="img-intro">
          <img src="assets/img/scatter.png" alt="Svift Intro Image">
        </div>
      </div>
    </div>
    <div id="gui-2" class="gui">
    </div>
  </div>

  <script src="build/d3.v4.min.js"></script>
  <script src="build/svift.min.js"></script>
  <script src="chatbot.js"></script>
  <script type="text/javascript">


    var dummyData = {
      "params": {
        "dev": true
      },
      "vis": {
        "type": "mosaic",
        "title": "Mosaic"
      },
      "length": 3000,
      "style": {
        "font": "Poppins",
        "fontLables": "InterfaceRegular",
        "color": {
          "main": "#71609B",
          "second": "#D8D8D8",
          "background": "#fff",
          "dataColors": ["#434343", "#FF5858", "#99C3F3", "#FFF680", "#EF96FF", "#B9FF6C"]
        }
      },
      "data": {
        "columns": ["Wert"],
        "types": ["int"],
        "data": [],
        "title": "Your title",
        "subTitle": "Your subtitle",
        "attribution": "made with svift",
        "source": "Source: Your source"
      }
    }

    function addDefaultData(d) {
      if (d == "columns" || d == "gooey") {
        dummyData.data.data = [["A", 33], ["B", 20]]
      }
      else {
        dummyData.data.data = [25];
      }
    }


    var cb;

    d3.json('./build/config.json', function (err, data) {
      if (err) { console.log(err); }

      /*
    
        //data contains an array of available visualisation types:
    
        //the thumbnails are available under:
        for(var key in data){
          var src = './build/thumbs/'+key+'_thumb.png';
          var src2 = './build/thumbs/'+key+'_thumb@2x.png';
        }

    
        //in order to load more config info on the selected vis load:
    
        d3.json('./build/'+key+'.json', function(err, data){
          //This json contains title and input method, in the future we can pack more meta data into this json, which will help us automatically generate the chatbot steps, right now only the data.input is relevant (we should come up with a set of rules)
        });
    
        //as we are using svift.min.js, which contains all available visualisations, we don't need to load individual vis types
        //in order to initiate one visualisation:
        for(var key in data){
          var vis = SVIFT.vis[(key.split('-'))[2]](DATA_FOR_VIS, d3.select('#VIS_CONTAINER'));
            vis.init();
            vis.start(); 
        }
    
        //After all elements are being entered, the resulting vis can be send to the backend via
        //The structure of output is collected from the vis modules
    
        var output = {
          "params":{
            "dev":true
          },
          "vis":{
            "type":"barchart",
            "title":"Barchart"
          },
          "data":{
            "columns":["Jahr","Wert"],
            "types":["date","int"],
            "data":[
              [2017,3.9],
              [2016,4.1],
              [2015,4.6],
              [2014,5.0],
              [2013,5.2],
              [2012,5.5],
              [2011,5.9],
              [2010,7.1],
              [2009,7.8]
            ]
          }
        };
    
        //The request will return an ID
    
        d3.xhr(URL OF SERVER)
          .header("Content-Type", "application/json")
          .post(
              JSON.stringify(output),
              function(err, rawData){
                  var data = JSON.parse(rawData);
                  console.log("got response", data);
              }
          );
    
        //This ID can then be used to poll the backend every 200 - milliseconds, in order to get the status of the rendering (right now this only returns an output when everything is done, this will be my (SEB) TODO for the weekend to send detailed progress information, but it will be something like this:
    
        //for each type the result is 0-1 (1 = done)
    
        var feedback = {
          svg:0.5,
          png:1,
          html:1,
          ...
        };
    
        //The ID is also equivalent to the permanent (7 day) url: svift.xyz/?/ID/ (index.html) > the index.html is actually not yet there, but i (SEB) will also take care of this...
      */




      //Make thumbs
      // createThumbs();

      function createThumbs() {
        var overlay = d3.select('#gui-1-overlay')
          .style('background-color', '#75FABF')
          .append('div')
          .attr('class', 'thumb-wrapper');

        var thumb = overlay.selectAll('.thumb')
          .data(d3.keys(data)).enter().append('div')
          .attr('class', 'thumb')
          .attr('id', function (d) { return 'thumb-' + d });

        thumb
          .append('img')
          .attr('src', function (d) { return './build/thumbs/' + d + '_thumb.png' })
          .on('click', selectViz)
          .style('opacity', 0)
          .transition()
          .delay(function (d, i) { return i * 300 })
          .style('opacity', 1);

        thumb.append('div').attr('class', "thumb-eyebrow").style('opacity', 0)
          .transition()
          .delay(function (d, i) { return i * 300 })
          .style('opacity', 1)
          .text(function (d) { return d });
      };








      function createViz(d) {

        visType = d;

        addDefaultData(visType);

        dummyData.vis.type = visType

        console.log(d);
        var overlay = d3.select('#gui-1-overlay').html('');

        var vizContainer = overlay.append('div')
          .attr('class', 'viz-container')
          .style('opacity', 0)
          .style('height', (d3.select("#gui-1-overlay").node().getBoundingClientRect().width * .7) + "px")
          .transition()
          .style('opacity', 1)

        d3.select('.viz-container').append('div').attr('class', 'viz-eyebrow').text('Selected chart type: ' + d);

        //Change viz sizes
        var vizSizes = [["twitter", 900, 450], ["facebook", 1200, 630], ["instagram", 1080, 1080], ["snapchat", 1080, 1920]];
        var vizSizesWrapper = overlay.append("div").attr("class", "viz-sizes-wrapper");
        var vizSizesHeader = vizSizesWrapper.append('div').classed('viz-sizes-header', true).text('Choose your format');
        var vizSizesBody = vizSizesWrapper.append('div').classed('viz-sizes-body', true);

        var vizSizesInputWrapper = vizSizesBody.append('div').classed('viz-sizes-input-wrapper', true);
        vizSizesInputWrapper.append('div').append('input').attr('placeholder', "300");
        vizSizesInputWrapper.append('div').html('x');
        vizSizesInputWrapper.append('div').append('input').attr('placeholder', "300");

        var vizSizesIconWrapper = vizSizesBody.append('div').classed('viz-sizes-icon-wrapper', true);

        vizSizesIconWrapper.selectAll('.viz-sizes')
          .data(vizSizes).enter().append('div')
          .attr("class", function (d) { return "viz-sizes" + " " + "icon" + " " + "icon-" + d[0] })
          .attr('id', function (d) { return d[0] })
          .on('click', function (d) { resizeViz(d) });

        function resizeViz(d) {

          var containerWidth = d3.select(".viz-container").node().getBoundingClientRect().width;

          d3.select(".viz-container")
            .style("height", (containerWidth / d[1]) * d[2] + "px")


          d3.select('.viz-container svg').remove();
          setTimeout(function () {

            var vis = SVIFT.vis[visType](dummyData, d3.select('.viz-container'));
            vis.init();
            vis.start();

          }, 700);
        }

        var vis = SVIFT.vis[visType](dummyData, d3.select('.viz-container'));
        vis.init();
        vis.start();

      }


      function renderViz() {

        d3.request('https://svift-backend.herokuapp.com/render')
          .header("Content-Type", "application/json")
          .mimeType("application/json")
          .post(
          JSON.stringify(dummyData),
          function (err, rawData) {

            var downloadBubble = cb.addBubble({ type: 'download', class: 'human' });
            var hasRequested = false;

            inter = setInterval(function () {
              d3.request('https://svift-backend.herokuapp.com/status/' + rawData.response).get(function (err, data) {

                if (!hasRequested) {
                  // setTimeout(function () {
                  cb.addBubble({ type: 'text', value: 'We are currently rendering your image', class: 'bot', delay: 2000 }, function () {
                    cb.addBubble({ type: 'text', value: 'You can either download the images directly above', class: 'bot', delay: 2000 }, function () {
                      cb.addBubble({ type: 'text', value: 'or the linke below', class: 'bot', delay: 2000 });
                    });
                  });

                  // },1000)
                  hasRequested = true;
                }

                var jResponse = JSON.parse(data.response);

                // var db = cb.getBubble(downloadBubble);
                var responseCounter = 0;

                for (var type in jResponse.full) {

                  var tau = 2 * Math.PI;

                  d3.select(".download-thumb-" + type + " .arc")
                    .transition()
                    .duration(900)
                    .attrTween("d", arcTween(jResponse.full[type] * tau, type));

                  function arcTween(newAngle, type) {
                    return function (d) {
                      var interpolate = d3.interpolate(d.endAngle, newAngle);
                      return function (t) {
                        d.endAngle = interpolate(t);
                        d3.select(".download-thumb-" + type + " .arc").datum({ endAngle: d.endAngle });
                        return arc(d);
                      };
                    };
                  }

                  if (jResponse.full[type] == 1) {
                    responseCounter++;
                    d3.select(".download-thumb-" + type).classed("download-active", true)
                    var parentDiv = d3.select(".download-thumb-" + type).node().parentNode;

                    d3.select(parentDiv).attr('href', 'https://s3.eu-central-1.amazonaws.com/svift-vis-output/output/' + rawData.response + '/' + rawData.response + "." + type);
                  }

                }

                if (responseCounter == 4) {

                  clearInterval(inter);
                  addFinalBubbles(rawData)

                }

              });
            }, 1000);
          }
          );

      }


      //Define Chatbot
      cb = chatbot(d3.select('#gui-2'));
      cb.showInput();


      /*Define bubble types*/

      cb.types['feedback'] = function (bubble, options, callback) {
        var feedbackWrapper = bubble.append('div').classed('feedback', true);
        feedbackWrapper.append('textarea').attr('id', 'feedback')
          .attr('placeholder', 'Feedback')
      }

      cb.types['send-feedback'] = function (bubble, options, callback) {
        bubble.style('background-color', '#fff');
        bubble.selectAll('.cb-choice')
          .data(options.value).enter().append('div')
          .attr('class', 'cb-choice')
          .text(function (d) { return d.label; })
          .on('click', function (d) {
            if (!d3.select(this).classed('cb-active')) {
              if (d.feedback) {

                var feedbackText = d3.select("#feedback").node().value;
                console.log(feedbackText)
                //send feeback here 
                cb.addBubble({ type: 'text', value: 'Thanks for your feedback!!', class: 'bot' });
              }
              d3.select(this).classed('cb-active', true);
              callback(d);
            }

          });
      }

      cb.types['select'] = function (bubble, options, callback) {
        bubble.style('background-color', '#fff');
        bubble.selectAll('.cb-choice')
          .data(options.value).enter().append('div')
          .attr('class', 'cb-choice')
          .text(function (d) { return d.label; })
          .on('click', function (d) {

            if (!d3.select(this).classed('cb-active')) {
              d3.select(this).classed('cb-active', true);
              callback(d);
              console.log(d)
            }


          });
      };


      cb.types['input'] = function (bubble, options, callback) {

        bubble.style('background-color', '#fff');
        bubble.attr('class', 'cb-bubble-input');

        var titleWrapper = bubble.append('div').classed('title', true);
        titleWrapper.append('input').attr('id', 'title')
          .attr('placeholder', 'Add your title here')
          .on('input', function () { updateTitle("#title-main", "#title", "title", "Your title") });
        var titleIcon = titleWrapper.append('div').classed('icon-toggle', true);

        var subtitleWrapper = bubble.append('div').classed('subtitle', true);
        subtitleWrapper.append('input').attr('id', 'subtitle')
          .attr('placeholder', 'Add your subtitle here')
          .on('input', function () { updateTitle("#title-sub", "#subtitle", "subTitle", "Your sub title") });
        var subIcon = subtitleWrapper.append('div').classed('icon-toggle', true);



        if (visType == "columns" || visType == "gooey") {

          var tableWrapper = bubble.append('div').attr("class", "table-wrapper");
          var table = tableWrapper.append('table').append('tbody');

          var tableRowTitle = table.append('tr');
          tableRowTitle.selectAll('td')
            .data(dummyData.data.data).enter().append('td')
            .append('input')
            .attr('placeholder', function (d) { return d[0] })
            .attr("data-index", function (d, i) { return i })
            .on('input', SVIFT.helper.debouncer(function (e) { updateTableDataTitle(this) }, 500));

          var tableRowNumbers = table.append('tr');
          tableRowNumbers.selectAll('td')
            .data(dummyData.data.data).enter().append('td').append('input')
            .attr('placeholder', function (d) { return d[1] })
            .attr("data-index", function (d, i) { return i })
            .on('input', SVIFT.helper.debouncer(function (e) { updateTableData(this) }, 500));


          var editRowButtons = tableWrapper.append('div').classed('column-editor-wrapper', true);
          var removeButton = editRowButtons.append('div').classed('column-editor-btn', true).classed('btn-remove', true).text('–').classed('disabled-btn', true)
            .on('click', function (d) { removeRow(d); });
          var addButton = editRowButtons.append('div').classed('column-editor-btn', true).classed('btn-add', true).text('+')
            .on('click', function (d) { addRow(d); });


          function addRow() {

            if (dummyData.data.data.length >= 2) {
              d3.select(".column-editor-btn.btn-remove").classed('disabled-btn', false)
            }

            var alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

            var lastEntry = dummyData.data.data[dummyData.data.data.length - 1];
            dummyData.data.data.push([alphabet[dummyData.data.data.length], lastEntry[1]])


            tableRowTitle.selectAll('td')
              .data(dummyData.data.data).enter().append('td')
              .append('input')
              .attr('placeholder', function (d, i) { return alphabet[i] })
              .attr("data-index", function (d, i) { return i })
              .on('input', SVIFT.helper.debouncer(function () { updateTableDataTitle(this) }, 500));

            tableRowNumbers.selectAll('td')
              .data(dummyData.data.data).enter()
              .append('td').append('input')
              .attr('placeholder', function (d) { return d[1] })
              .attr("data-index", function (d, i) { return i })
              .on('input', SVIFT.helper.debouncer(function () { updateTableData(this) }, 500))

            redrawViz(dummyData)
          }


          function removeRow() {

            if (dummyData.data.data.length == 2) {
              return
            }
            if (dummyData.data.data.length == 3) {
              d3.select(".column-editor-btn.btn-remove").classed('disabled-btn', true)
            }

            dummyData.data.data.pop();

            tableRowTitle.selectAll('td')
              .data(dummyData.data.data).exit().remove();

            tableRowNumbers.selectAll('td')
              .data(dummyData.data.data).exit().remove();

            redrawViz(dummyData)

          };
        }
        //if single Number
        else {
          var input = bubble.append('input').classed('number', true)
            .attr('id', 'number')
            .attr('type', 'number')
            .attr('placeholder', function () { return dummyData.data.data })
            .attr('min', '0')
            .attr('max', '100')
            .on('input', SVIFT.helper.debouncer(function (e) { updateSingleData() }, 500));


          function updateSingleData() {

            var inputValue = d3.select("#number").node().value;
            if (inputValue > 100 && visType == "mosaic") {
              inputValue = inputValue.slice(0, 2);
              d3.select("#number").property("value", inputValue);
            }

            dummyData.data.data = [inputValue];
            d3.select("#number").attr('placeholder', '');

            redrawViz(dummyData)
          }


        }

        var sourceWrapper = bubble.append('div').classed('source', true);
        sourceWrapper.append('input').attr('id', 'source-input')
          .attr('placeholder', 'Add your source here')
          .on('input', function () { updateTitle("#source", "#source-input", "source", "Source: Your source") });
        var subIcon = sourceWrapper.append('div').classed('icon-toggle', true);


        function redrawViz(data) {
          d3.select('.viz-container svg').remove();
          var vis = SVIFT.vis[visType](data, d3.select('.viz-container'));
          vis.init();
          vis.start();
        }


        function validateNumber(d) {
          var inputValue = d.replace(",", ".");
          if (isNaN(inputValue)) {
            inputValue = null;
            return null
          } else {
            inputValue = Number(inputValue);
            return inputValue;
          }

        }

        function updateTableDataTitle(obj) {
          var dataPosition = d3.select(obj).attr("data-index");
          var dataValue = d3.select(obj).node().value;
          dummyData.data.data[dataPosition][0] = dataValue || "";

          d3.select(obj).attr('placeholder', '');

          redrawViz(dummyData)
        }

        function updateTableData(obj) {

          d3.select(obj).attr('placeholder', null);

          var dataPosition = d3.select(obj).attr("data-index");
          var inputValue = d3.select(obj).node().value;
          var newData = validateNumber(inputValue);

          if (newData == null) {
            d3.select(obj).classed('bad-input-data', true)
          } else {
            d3.select(obj).classed('bad-input-data', false)
          }
          dummyData.data.data[dataPosition][1] = newData;

          redrawViz(dummyData)
        }

        function updateTitle(selectorViz, selectorInput, selectorData, altText) {

          var inputText = d3.select(selectorInput).node().value;
          dummyData.data[selectorData] = inputText || altText;
          if (selectorData == "source" && inputText) { dummyData.data[selectorData] = "Source: " + inputText };
          d3.select(selectorViz).text(dummyData.data[selectorData]);

        }

      };



      cb.types['text'] = function (bubble, options, callback) {

        if (('delay' in options) && options.delay) {
          var animatedCircles = '<div class="circle"></div><div class="circle"></div><div class="circle"></div>';
          bubble.append('div')
            .attr('class', 'cb-waiting')
            .html(animatedCircles);

          setTimeout(function () {

            bubble.select(".cb-waiting").remove();
            appendText(bubble, options, callback);

          }, (isNaN(options.delay) ? 1000 : options.delay));
        } else {
          appendText(bubble, options, callback);
        }

        function appendText(bubble, options, callback) {
          bubble.attr('class', 'bubble-ctn-' + options.class).append('p')
            .style("width", "50px")
            .html(options.value)
            .transition()
            .duration(200)
            .style("width", "auto")
            .style('opacity', 1);

          if (options.emoji) {
            bubble.append('img').attr('class', 'emoji').attr('src', './assets/emojis/' + options.emoji + '.png');
          }

          callback();
        }

      }


      cb.types['themes'] = function (bubble, options, callback) {
        var themes = ['saturn', 'mars', 'pluto'];
        var themesWrapper = bubble.append('div')
          .attr('class', 'cb-themes-wrapper');

        themesWrapper.selectAll('div').data(themes).enter()
          .append('div')
          .attr('class', function (d) { return 'theme-thumb theme-thumb-' + d })
          .on('click', function (d) {
            selectTheme(d);
          })
          .append('img')
          .attr('src', function (d) { return './assets/img/themes/theme-' + d + '.png' });

        function selectTheme(theme) {
          switch (theme) {
            case "saturn":
              dummyData.style.color.main = 'rgba(113, 96, 155, 1)';
              dummyData.style.font = 'Poppins';
              break;
            case "mars":
              dummyData.style.color.main = '#FE9592';
              dummyData.style.font = 'Merriweather';
              break;
            case "pluto":
              dummyData.style.color.main = '#FBC469';
              dummyData.style.font = 'Roboto Mono';
              break;
            default:
              dummyData.style.color.main = 'rgba(113, 96, 155, 1)';
          };

          d3.select('.viz-container svg').remove();
          var vis = SVIFT.vis[visType](dummyData, d3.select('.viz-container'));
          vis.init();
          vis.start();
        };
      }


      cb.types['download'] = function (bubble, options, callback) {

        var icons = ['png', 'svg', 'gif', 'html']; //'mpeg'
        var altNames = {
          "png": "Picture",
          "svg": "Vector",
          "gif": "gif",
          "html": "embed"
        }
        var downloadWrapper = bubble.append('div')
          .attr('class', 'cb-download-wrapper');


        // Progress arc animation from here: http://bl.ocks.org/mbostock/5100636
        var tau = 2 * Math.PI;

        arc = d3.arc()
          .innerRadius(36)
          .outerRadius(42)
          .startAngle(0)
        // .cornerRadius(50);

        var group = downloadWrapper.selectAll('a').data(icons).enter()
          .append('a')
          .attr('target', '"_blank"')
          .append('svg')
          .attr('class', function (d) { return 'download-thumb download-thumb-' + d + ' radial' })

        group.append("g").append("text")
          .text(function (d) { return altNames[d] })
          .attr("fill", "black")
          .attr("text-anchor", "middle")
          .attr("font-size", "15px")
          .attr("x", "40px")
          .attr("y", "45px")

        group.append('g').append("path")
          .datum({ endAngle: 0 })
          .attr("class", "arc")
          .attr("d", arc);

      }





      /*Start Chatbot*/

      cb.addBubble({ type: 'text', value: 'Hi there, welcome to SVIFT!', class: 'bot', emoji: 'wave', delay: 1000 }, function () {
        cb.addBubble({ type: 'text', value: 'Want to visualize some data for your project?', class: 'bot', delay: 500 }, function () {
          setTimeout(function () {
            cb.addBubble({ type: 'select', value: [{ label: 'Sounds great! Let’s go!' }], class: 'human' }, onEntry);
          }, 100)
        });
      });

      function onEntry() {
        cb.addBubble({ type: 'text', value: 'Ok then, choose your chart type on the left side!', class: 'bot', delay: 500 });
        setTimeout(function () {
          d3.select('#gui-1-overlay').style('left', '0');
          createThumbs();
        }, 500)
        d3.select('.inner').transition().delay(1000).style('display', 'none');
        d3.select('#gui-1').transition().delay(1000).style('background', '#75FABF');

      }


      function selectViz() {
        var tile = d3.selectAll('.thumb');
        tile.on('click', function (d) {

          cb.addBubble({ type: 'text', value: 'I want to make a ' + d + ' chart ', class: 'human', emoji: 'smile' }, function () {
            cb.addBubble({ type: 'text', value: "Good choice! Let's enter your data ", class: 'bot', emoji: 'write', delay: 500 }, function () {

              createViz(d);

              setTimeout(function () {

                cb.addBubble({ type: 'input', class: 'human' });
                cb.addBubble({ type: 'select', value: [{ label: 'I am done entering my data!' }], class: 'human' }, onDataSubmitted);

              }, 500)
            });
          })
        });
      }


      function onDataSubmitted() {

        cb.addBubble({ type: 'text', value: 'Ok, last step: Choose your design! ', class: 'bot', emoji: 'style', delay: 500 }, function () {

          cb.addBubble({ type: 'themes', class: 'human' });

          setTimeout(function () {

            cb.addBubble({ type: 'select', value: [{ label: 'I am done!' }], class: 'human send' }, onFinish);

          }, 500)

        })

      }


      var requestSend = false;
      function onFinish() {

        if (requestSend) { return }
        requestSend = true;
        d3.select(".cb-bubble.human.send .cb-choice").classed('cb-active', true)
        cb.addBubble({ type: 'text', value: 'Please wait while I build your chart', class: 'bot', emoji: 'smile' }, renderViz);

      }

      function addFinalBubbles(rawData) {

        cb.addBubble({ type: 'text', value: '<span>Get your charts here: <a class="bubble-link" target="_blank" style="text-decoration: none; color:rgba(113, 96, 155, 1);"href="' + './download.html#' + rawData.response + '">www.svift.xyz/' + rawData.response + '</a></span>', class: 'bot' });

        setTimeout(function () {

          cb.addBubble({ type: 'text', value: 'Thanks for using svift! Would you like to give us some feedback?', class: 'bot' });

          setTimeout(function () {
            cb.addBubble({ type: 'feedback', class: 'human' });
            cb.addBubble({ type: 'send-feedback', value: [{ label: 'send feedback', feedback: true }, { label: 'next time', feedback: false }], class: 'human' }, function () {

              setTimeout(function () {

                cb.addBubble({ type: 'text', value: 'Would you like to build another chart?', class: 'bot' });
                cb.addBubble({ type: 'select', value: [{ label: 'Yes' }], class: 'human' }, function () {
                  location.reload();
                });

              }, 500)

            });
          }, 500)

        }, 1000)
      }

    });

  </script>
</body>

</html>