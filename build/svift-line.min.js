var SVIFT={};SVIFT.helper={},SVIFT.helper.debouncer=function(t,e){var n,a=e||200;return function(){var e=this,i=arguments;clearTimeout(n),n=setTimeout(function(){t.apply(e,Array.prototype.slice.call(i))},a)}},SVIFT.helper.interpolate=function(t){var e,n={};for(n.def=t,n.interpolate=[],n.duration=0,e=1;n.def.length>e;e++)"ease"in n.def[e]||(n.def[e].ease=!1),n.interpolate.push(d3.interpolate(n.def[e-1].value,n.def[e].value)),n.duration+=n.def[e].duration;var a=0;for(e=1;n.def.length>e;e++)n.def[e].duration=n.def[e].duration/n.duration,n.def[e].start=a,a+=n.def[e].duration;return n.i=function(t){for(var e=1;n.def.length>e;e++)if(t>=n.def[e].start&&n.def[e].start+n.def[e].duration>=t)return n.def[e].ease?n.interpolate[e-1](n.def[e].ease((t-n.def[e].start)/n.def[e].duration)):n.interpolate[e-1]((t-n.def[e].start)/n.def[e].duration)},n.i},SVIFT.helper.switchCol=function(t,e,n){return t.forEach(function(t){var a=t[e];t[e]=t[n],t[n]=a}),t},SVIFT.helper.transpose=function(t){var e={};return t.forEach(function(t){for(var n in t)n in e||(e[n]=[])}),t.forEach(function(t){for(var n in e)n in t?e[n].push(t[n]):e[n].push(null)}),e},SVIFT.helper.cleanAxis=function(t){var e;e=t.attr("text-anchor")?t:t.select('g[text-anchor="*"]');var n=e.attr("text-anchor");e.selectAll("text").attr("text-anchor",n);var a=e.attr("font-size");e.selectAll("text").each(function(){var t=d3.select(this);["y","x"].forEach(function(e){var n=t.attr("d"+e);if(n){n.indexOf("em")>=0&&(n=parseFloat(n.substr(0,n.length-2))*a),t.attr("d"+e,0);var i=t.attr(e);i&&(n+=parseFloat(i)),t.attr(e,n)}})})},SVIFT.vis={},SVIFT.vis.base=function(t,e){var n={};n.data=t,n.container=e,n.g=null,n.svg=null,n.scale=!1;var a,i;return n.config={maxWidth:4096,maxHeight:4096,margin:{top:20,right:20,bottom:20,left:20},font:{sizes:{500:16,0:14},"default":"14px"},paddingTopText:20,paddingBottomText:20},n.timeline={},n.init=function(){i=n.container.node().offsetWidth,a=n.container.node().offsetHeight;var e;for(var o in n.config.font.sizes)i>=o&&(e=n.config.font.sizes[o]);n.svg=n.container.append("svg").attr("width","100%").attr("height","100%").style("background-color","#ffffff").attr("viewBox","0 0 "+i+" "+a),n.defs=n.svg.append("defs"),n.g=n.svg.append("g").attr("transform","translate("+n.config.margin.top+","+n.config.margin.left+")"),n.config.topTextWrapper=n.g.append("g").attr("text-anchor","middle").attr("class","title-wrapper").attr("font-family",t.style.font),n.config.titleMain=n.config.topTextWrapper.append("text").text(t.data.title).attr("font-size","1.7em").attr("fill",t.style.color.main).attr("id","title-main"),n.config.titleSub=n.config.topTextWrapper.append("text").text(t.data.subTitle).attr("font-size","1em").attr("fill",t.style.color.second).attr("id","title-sub"),n.config.bottomTextWrapper=n.g.append("g").attr("font-family","InterfaceRegular"),n.config.attribution=n.config.bottomTextWrapper.append("text").text(t.data.attribution).attr("font-size",n.config.font.default).attr("fill",t.style.color.second).attr("font-style","italic"),n.config.source=n.config.bottomTextWrapper.append("text").text(t.data.source).attr("font-size",n.config.font.default).attr("fill",t.style.color.second).attr("id","source"),n.config.vizContainer=n.g.append("g").attr("class","viz-container"),n.playHead=0,n.setup(),n.resizeText(),n.resize();for(var o in n.timeline){var r=n.timeline[o];r.end>n.playTime&&(n.playTime=r.end)}n.time.step=n.playTime/(n.playTime/1e3*n.time.fps),"function"==typeof window.callPhantom&&window.callPhantom({msg:"setupDone"}),d3.select(window).on("resize",SVIFT.helper.debouncer(function(){n.preResize(),n.scale||(n.resizeText(),n.resize())},200))},n.process=function(){},n.setup=function(){},n.update=function(){},n.preResize=function(){i=n.container.node().offsetWidth,a=n.container.node().offsetHeight,n.scale||n.svg.attr("viewBox","0 0 "+i+" "+a)},n.setScale=function(t){n.scale=t},n.resize=function(){},n.resizeText=function(){var t;for(var e in n.config.font.sizes)i>=e&&(t=n.config.font.sizes[e]);500>=i&&(n.config.margin.top=15,n.config.margin.right=15,n.config.margin.left=15,n.config.margin.bottom=15),n.svg.attr("font-size",t);var a=n.container.node().offsetWidth-n.config.margin.left-n.config.margin.right,o=a/2;n.config.titleMain.attr("x",o).attr("y",function(){return n.config.titleMainHeight=this.getBBox().height,n.config.titleMainHeight}),n.config.titleSub.attr("x",o).attr("y",function(){return n.config.titleMainHeight+this.getBBox().height+5}),n.config.bottomTextWrapper.attr("transform","translate(0,"+(n.container.node().offsetHeight-n.config.margin.top-n.config.margin.bottom)+")"),n.config.attribution.attr("x",function(){return a-this.getBBox().width}),n.config.source.attr("x",0),n.config.topTextHeight=n.config.topTextWrapper.node().getBBox().height+n.config.paddingTopText,n.config.bottomTextHeight=n.config.bottomTextWrapper.node().getBBox().height+n.config.paddingBottomText,n.config.vizContainer.attr("transform","translate(0,"+n.config.topTextHeight+")")},n.draw=function(t){for(var e in n.timeline){var a=n.timeline[e];t>=a.start&&a.end>=t?a.func((t-a.start)/(a.end-a.start)):t>a.end&&a.func(1)}},n.playHead=0,n.playState=!1,n.playTime=0,n.time={fps:30,step:0,elapsed:0,fpsInterval:1e3/30,then:0,startTime:0,now:0},n.play=function(){n.playState&&("function"==typeof window.callPhantom?(n.playHead+=n.time.step,n.playTime>=n.playHead?(n.draw(n.playHead),window.callPhantom({msg:"drawDone",playHead:n.playHead})):(n.playHead=n.playTime,n.draw(n.playHead),n.pause(),window.callPhantom({msg:"playDone"}))):(0===n.time.then&&(n.time.then=n.time.startTime=Date.now()),n.time.now=Date.now(),n.time.elapsed=n.time.now-n.time.then,n.playTime>=n.time.now-n.time.startTime?(window.requestAnimationFrame(n.play),n.time.elapsed>n.time.fpsInterval&&(n.time.then=n.time.now-n.time.elapsed%n.time.fpsInterval,n.playHead=n.time.now-n.time.startTime,n.draw(n.playHead))):(n.playHead=n.playTime,n.goTo(1),n.pause())))},n.start=function(){n.playState=!0,n.play()},n.pause=function(){n.playState=!1},n.goTo=function(t){n.playTime>=t&&(n.playHead=t*n.playTime,n.draw(n.playHead)),n.pause()},n},SVIFT.vis.line=function(t,e){var n=SVIFT.vis.base(t,e);return n.d3config={},n.setup=function(){},n.process=function(){},n.update=function(){},n.resize=function(){for(var e=n.container.node().offsetWidth-2*(n.config.margin.left+n.config.margin.right),a=n.container.node().offsetHeight-n.config.margin.top-n.config.margin.bottom-n.config.topTextHeight-n.config.bottomTextHeight,i=[1,t.data.data.length],o=[],r=0;t.data.data.length>r;r++)o=o.concat(t.data.data[r].data);var f=d3.extent(o,function(t){return t}),c=d3.scaleLinear().domain(i).range([0,e]),d=d3.scaleLinear().domain(f).range([a,0]),l=n.g.append("g").datum(t.data.data).attr("width",e).attr("height",a).append("g").attr("transform","translate(0,"+(n.config.margin.top+n.config.topTextHeight)+")");console.log(t.data.data.length),l.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+a+")").call(d3.axisBottom(c).tickFormat(function(e,n){return t.data.data[n].label}).ticks(t.data.data.length-1)),l.append("g").attr("class","axis axis--y").call(d3.axisLeft(d)).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").text("Price ($)");for(var s=["red","blue","green","yellow","pink","steelblue"],r=0;t.data.data[0].data.length>r;r++){var g=d3.line().defined(function(t){return t.data[r]}).x(function(t,e){return c(e+1)}).y(function(t){return d(t.data[r])}).curve(d3.curveCatmullRom.alpha(.5)),p=l.append("path").attr("fill","none").attr("stroke",s[r]).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("stroke-width",3.5).attr("d",g),u=p.node().getTotalLength();p.attr("stroke-dasharray",u+" "+u).attr("stroke-dashoffset",u).transition().duration(2e3).ease(d3.easeCubicInOut).attr("stroke-dashoffset",0)}},n.timeline={},n};