var SVIFT={};SVIFT.helper={},SVIFT.helper.debouncer=function(t,e){var i,a=e||200;return function(){var e=this,n=arguments;clearTimeout(i),i=setTimeout(function(){t.apply(e,Array.prototype.slice.call(n))},a)}},SVIFT.helper.interpolate=function(t){var e,i={};for(i.def=t,i.interpolate=[],i.duration=0,e=1;i.def.length>e;e++)"ease"in i.def[e]||(i.def[e].ease=!1),i.interpolate.push(d3.interpolate(i.def[e-1].value,i.def[e].value)),i.duration+=i.def[e].duration;var a=0;for(e=1;i.def.length>e;e++)i.def[e].duration=i.def[e].duration/i.duration,i.def[e].start=a,a+=i.def[e].duration;return i.i=function(t){for(var e=1;i.def.length>e;e++)if(t>=i.def[e].start&&i.def[e].start+i.def[e].duration>=t)return i.def[e].ease?i.interpolate[e-1](i.def[e].ease((t-i.def[e].start)/i.def[e].duration)):i.interpolate[e-1]((t-i.def[e].start)/i.def[e].duration)},i.i},SVIFT.helper.switchCol=function(t,e,i){return t.forEach(function(t){var a=t[e];t[e]=t[i],t[i]=a}),t},SVIFT.helper.transpose=function(t){var e={};return t.forEach(function(t){for(var i in t)i in e||(e[i]=[])}),t.forEach(function(t){for(var i in e)i in t?e[i].push(t[i]):e[i].push(null)}),e},SVIFT.helper.cleanAxis=function(t){var e;e=t.attr("text-anchor")?t:t.select('g[text-anchor="*"]');var i=e.attr("text-anchor");e.selectAll("text").attr("text-anchor",i);var a=e.attr("font-size");e.selectAll("text").each(function(){var t=d3.select(this);["y","x"].forEach(function(e){var i=t.attr("d"+e);if(i){i.indexOf("em")>=0&&(i=parseFloat(i.substr(0,i.length-2))*a),t.attr("d"+e,0);var n=t.attr(e);n&&(i+=parseFloat(n)),t.attr(e,i)}})})},SVIFT.render=function(){function t(t){return t.each(function(){var t=d3.select(this),e=t.attr("font-size");t.selectAll("text").each(function(){var t=d3.select(this);["y","x"].forEach(function(i){var a=t.attr("d"+i);if(a){a.indexOf("em")>=0&&(a=parseFloat(a.substr(0,a.length-2))*e),t.attr("d"+i,0);var n=t.attr(i);n&&(a+=parseFloat(n)),t.attr(i,a)}})})}),!0}console.log("0.0.5");var e,i,a,n,o={},r={init:!1,setup:!1,gif:!1,gifStep:0,buildStep:0},s={status:0,full:{svg:0,png:0,social:0,gif:0}},d=JSON.parse(JSON.stringify(s)),l=500,c=500,f={},g={},u=[["fill","fill"],["font-family","fontFamily"],["font-size","fontSize"],["font-weight","fontWeight"],["text-anchor","textAnchor"],["stroke","stroke"],["stroke-width","strokeWidth"]],h={video:{size:{width:500,height:500},scale:{width:500,height:500},frames:120},sizes:[{file:"instagram",name:"Instagram",size:{width:540,height:540},scale:{width:1080,height:1080}},{file:"linkedin",name:"LinkIn",size:{width:700,height:400},scale:{width:1400,height:800}},{file:"google",name:"Google+",size:{width:497,height:373},scale:{width:994,height:746}},{file:"tumblr",name:"Tumblr",size:{width:640,height:960},scale:{width:1280,height:1920}},{file:"pinterest",name:"Pinterest",size:{width:600,height:600},scale:{width:1200,height:1200}},{file:"twitter",name:"Twitter",size:{width:512,height:256},scale:{width:1024,height:512}},{file:"snapchat",name:"Snapchat",size:{width:476,height:810},scale:{width:952,height:1620}},{file:"facebook",name:"Facebook",size:{width:600,height:315},scale:{width:1200,height:630}},{file:"horizontal",name:"Horizontal / Landscape",size:{width:1024,height:768},scale:{width:2048,height:1536}},{file:"vertical",name:"Vertical / Portrait",size:{width:800,height:1200},scale:{width:1600,height:2400}},{file:"square",name:"Square",size:{width:512,height:512},scale:{width:1024,height:1024}}]},p={};return h.sizes.forEach(function(t,e){p[t.file]=e}),o.init=function(){r.running||(r.running=!0,e=d3.select("body").append("div").attr("id","offscreen-svg").style("visibility","hidden").style("pointer-events","none").style("top",0).style("left",0).style("z-index",999).style("position","absolute"),o.resizeSVG(l,c,0,0))},o.setupVis=function(t){r.setup=!0,i=t,e.select("svg").remove(),a=SVIFT.vis[i.vis.type](i,e),a.setScale(!0),a.init(),a.setScale(!1)},o.drawSVG=function(t){a.goTo(t)},o.resizeSVG=function(t,i,n,o){r.setup?(a.setScale(!1),e.select("svg").style("width",t+"px").style("height",i+"px"),a.preResize(),a.setScale(!0),e.select("svg").style("width",n+"px").style("height",o+"px"),a.preResize()):e.select("svg").style("width",t+"px").style("height",i+"px")},o.inlineCSS=function(){d3.selectAll("#offscreen-svg svg g, #offscreen-svg svg text, #offscreen-svg svg path, #offscreen-svg svg rect, #offscreen-svg svg circle, #offscreen-svg svg line, #offscreen-svg svg ellipse, #offscreen-svg svg tspan, #offscreen-svg svg title").each(function(){var t=d3.select(this),e=window.getComputedStyle(t.node());u.forEach(function(i){var a=e[i[1]];null!==t.attr(i[0])&&(a=t.attr(i[0])),t.style(i[0],a)})})},o.buildPNG=function(t,e){if(r.setup&&r.running&&!r.gif){var i=h.sizes[p[t]];o.resizeSVG(i.size.width,i.size.height,i.scale.width,i.scale.height),a.reset(),o.drawSVG(1),o.inlineCSS(),o.toDataURL(function(i){f[t]=i,g[t]=o.getSVG(),e()})}else console.log("Either render not initialised or currently rendering a GIF.")},o.toDataURL=function(t){toDataURL(document.getElementById("offscreen-svg").children[0],"image/png",{callback:t})},o.buildGif=function(t){r.setup&&r.running&&!r.gif&&(r.gif=!0,r.gifStep=0,o.resizeSVG(h.video.size.width,h.video.size.height,h.video.scale.width,h.video.scale.height),a.reset(),n=new GIF({workers:3,quality:1,repeat:0,debug:!0,width:h.video.size.width,height:h.video.size.height}).on("progress",function(t){s.full.gif=t}).on("finished",function(e){f.video=URL.createObjectURL(e),r.gif=!1,t()}),o.preFrame())},o.preFrame=function(){o.drawSVG(1),o.inlineCSS(),o.toDataURL(function(t){var e=new Image;e.crossOrigin="*",e.onload=function(){n.addFrame(e,{delay:1,copy:!0}),a.reset(),o.addFrame()},e.src=t})},o.addFrame=function(){o.drawSVG(r.gifStep/h.video.frames),o.inlineCSS(),o.toDataURL(function(t){var e=new Image;e.crossOrigin="*",e.onload=function(){n.addFrame(e,{delay:30,copy:!0}),r.gifStep++,r.gifStep>=h.video.frames?(n.addFrame(e,{delay:4e3,copy:!0}),n.render()):o.addFrame()},e.src=t})},o.buildSet=function(){s=JSON.parse(JSON.stringify(d)),r.buildStep=0,o.buildNextPNG()},o.buildNextPNG=function(){o.buildPNG(h.sizes[r.buildStep].file,function(){r.buildStep++,r.buildStep>=h.sizes.length?(s.full.png=1,s.full.social=1,o.buildGif(function(){s.full.gif=1,s.status=1})):o.buildNextPNG()})},o.getStatus=function(){return s},o.downloadGIF=function(){o.generateDownload("video")},o.generateDownload=function(t,e){var i=document.createElement("a");"svg"===e?(i.download=t+".svg",i.href=g[t]):(i.download=t+("video"===t?".gif":".png"),i.href=f[t]),document.body.appendChild(i),i.click()},o.getSVG=function(){var e=d3.selectAll('#offscreen-svg g[text-anchor="middle"]');e.selectAll("text").attr("text-anchor","middle"),t(e),e=d3.selectAll('#offscreen-svg g[text-anchor="end"]'),e.selectAll("text").attr("text-anchor","end"),t(e);var i=d3.select("#offscreen-svg").html(),a=[["sans-serif","Verdana"],['width="100%"','width="'+l+'"'],['height="100%"','height="'+c+'"'],["<svg",'<?xml version="1.0" standalone="no"?><svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"']];return a.forEach(function(t){i=i.split(t[0]).join(t[1])}),"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(i)},o}(),SVIFT.vis={},SVIFT.vis.base=function(t,e){var i={};return i.data=t,i.setData=function(t){i.data.data=t},i.container=e,i.g=null,i.svg=null,i.scale=!1,i.vizContainer=null,i.vizSize={width:500,height:500},i.vizInitSize={width:500,height:500},i.containerSize={width:0,height:0},i.theme=t.style.theme,i.color=t.style.color.main,i.custom=null,i.bg=null,i.config={maxWidth:4096,maxHeight:4096,margin:{top:20,right:20,bottom:20,left:20},font:{sizes:{450:15,0:13},"default":"13px"},footerHeight:40,custom:!1},i.text={},i.timeline={},i.init=function(){i.scale=!1,i.vizInitSize.width=i.containerSize.width=i.container.node().offsetWidth,i.vizInitSize.height=i.containerSize.height=i.container.node().offsetHeight,i.vizSize.width=i.vizInitSize.width-i.config.margin.right-i.config.margin.left,i.vizSize.height=i.vizInitSize.height,i.svg=i.container.append("svg").style("background-color","#ffffff").attr("viewBox","0 0 "+i.containerSize.width+" "+i.containerSize.height).attr("class",i.theme+" "+i.color),i.defs=i.svg.append("defs"),i.bg=i.svg.append("rect").style("fill","#fff").style("border","2px solid #fff"),i.g=i.svg.append("g").attr("transform","translate("+i.config.margin.top+","+i.config.margin.left+")"),i.custom=i.g.append("g"),i.data.custom&&(i.custom.attr("transform","translate("+(("left"==i.data.custom.logo.align?0:"right"==i.data.custom.logo.align?i.vizInitSize.width-i.config.margin.left-i.config.margin.right:i.vizInitSize.width/2-i.config.margin.left)+i.data.custom.logo.x_offset)+","+(("bottom"==i.data.custom.logo.valign?i.vizInitSize.height-(i.config.margin.bottom+i.config.margin.top):i.config.margin.top)+i.data.custom.logo.y_offset)+")"),i.custom.append("image").attr("xlink:href",i.data.custom.logo.url).attr("width",i.data.custom.logo.width).attr("height",i.data.custom.logo.height).attr("x","left"==i.data.custom.logo.align?0:"right"==i.data.custom.logo.align?-i.data.custom.logo.width:-i.data.custom.logo.width/2).attr("y","bottom"==i.data.custom.logo.valign?-i.data.custom.logo.height:0)),i.text.head=i.g.append("g").attr("class","title-wrapper"),i.text.title=i.text.head.append("text").attr("class","titleFont"),i.text.subtitle=i.text.head.append("text").attr("class","subtitleFont"),i.text.foot=i.g.append("g").attr("transform","translate(0,"+(i.containerSize.height-i.config.margin.bottom-i.config.margin.top)+")").attr("class","bottomTextWrapper"),i.text.attribution=i.text.foot.append("text").attr("x",i.containerSize.width-i.config.margin.left-i.config.margin.right).text(i.data.data.attribution).attr("class","attribution"),i.text.source=i.text.foot.append("text").text(i.data.data.source).attr("class","source"),i.vizContainer=i.g.append("g").attr("class","viz-container"),i.playHead=0,i.setup(),i.updateHead();for(var t in i.timeline){var e=i.timeline[t];e.end>i.playTime&&(i.playTime=e.end)}i.time.step=i.playTime/(i.playTime/1e3*i.time.fps),"function"==typeof window.callPhantom&&window.callPhantom({msg:"setupDone"}),d3.select(window).on("resize",SVIFT.helper.debouncer(function(){i.preResize(),i.scale||i.resize()},200))},i.updateHead=function(){var t=30,e=0,a=1.1,n=t;if(i.vizSize.width=i.vizInitSize.width-i.config.margin.left-i.config.margin.right,i.data.data.title.length>0){var o=i.data.data.title.split("\n");i.text.title.selectAll("tspan").remove(),o.forEach(function(e){for(var a=t,o=i.text.title.append("tspan").text(e).attr("x",0).style("font-size",a+"px");o.node().getComputedTextLength()>i.vizSize.width&&a>8;)a--,o.style("font-size",a+"px");n>a&&(n=a)}),i.text.title.attr("transform","translate(0,"+n+")"),i.text.title.selectAll("tspan").style("font-size",n+"px").attr("dy",function(t,e){return e>0?n*a:0}),e=n*a*(o.length-1)+n}var r=15,s=1.1,d=0,l=r>n?.75*n:r;i.data.data.subTitle.length>0&&(o=i.data.data.subTitle.split("\n"),i.text.subtitle.selectAll("tspan").remove(),o.forEach(function(t){for(var e=r,a=i.text.subtitle.append("tspan").text(t).attr("x",0).style("font-size",e+"px");a.node().getComputedTextLength()>i.vizSize.width&&e>5;)e--,a.style("font-size",e+"px");l>e&&(l=e)}),i.text.subtitle.selectAll("tspan").attr("dy",function(t,e){return e>0?l*s:0}).style("font-size",l+"px"),i.text.subtitle.attr("transform","translate(0,"+Math.round(e+1.55*l)+")"),d+=2*l+l*s*(o.length-1)),i.vizContainer.attr("transform","translate(0,"+(d+e)+")"),i.vizSize.height=i.vizInitSize.height-(d+e)-i.config.margin.top-i.config.margin.bottom-i.config.footerHeight-15,i.text.foot.attr("transform","translate(0,"+(i.vizInitSize.height-i.config.margin.bottom-i.config.margin.top)+")"),i.data.custom&&i.custom.attr("transform","translate("+(("left"==i.data.custom.logo.align?0:"right"==i.data.custom.logo.align?i.vizInitSize.width-i.config.margin.left-i.config.margin.right:i.vizInitSize.width/2-i.config.margin.left)+i.data.custom.logo.x_offset)+","+(("bottom"==i.data.custom.logo.valign?i.vizInitSize.height-(i.config.margin.bottom+i.config.margin.top):i.config.margin.top)+i.data.custom.logo.y_offset)+")"),i.text.attribution.attr("x",i.vizInitSize.width-i.config.margin.left-i.config.margin.right),i.updateSource(),i.resize()},i.setTheme=function(t){i.svg.classed(i.theme,!1),i.theme=t,i.svg.classed(i.theme,!0),i.updateHead()},i.setColor=function(t){i.svg.classed(i.color,!1),i.color=t,i.svg.classed(i.color,!0),i.updateHead()},i.updateSource=function(){i.text.source.text(i.data.data.source)},i.reset=function(){i.playState=!1,i.playHead=0,i.vizContainer.selectAll("*").remove(),i.setup(),i.resize()},i.process=function(){},i.setup=function(){},i.update=function(){},i.preResize=function(){i.containerSize.width=i.container.node().offsetWidth,i.containerSize.height=i.container.node().offsetHeight,i.bg.attr("x",-2).attr("y",-2).attr("width",i.containerSize.width+4).attr("height",i.containerSize.height+4),i.scale||(i.svg.attr("viewBox","0 0 "+i.containerSize.width+" "+i.containerSize.height),i.vizInitSize.width=i.containerSize.width,i.vizInitSize.height=i.containerSize.height),i.updateHead()},i.setScale=function(t){i.scale=t},i.resize=function(){},i.draw=function(t){for(var e in i.timeline){var a=i.timeline[e];t>=a.start&&a.end>=t?a.func((t-a.start)/(a.end-a.start)):t>a.end?a.func(1):a.start>t&&a.func(0)}},i.playHead=0,i.playState=!1,i.playTime=0,i.time={fps:30,step:0,elapsed:0,fpsInterval:1e3/30,then:0,startTime:0,now:0},i.play=function(){i.playState&&("function"==typeof window.callPhantom?(i.playHead+=i.time.step,i.playTime>=i.playHead?(i.draw(i.playHead),window.callPhantom({msg:"drawDone",playHead:i.playHead})):(i.playHead=i.playTime,i.draw(i.playHead),i.pause(),window.callPhantom({msg:"playDone"}))):(0===i.time.then&&(i.time.then=i.time.startTime=Date.now()),i.time.now=Date.now(),i.time.elapsed=i.time.now-i.time.then,i.playTime>=i.time.now-i.time.startTime?(window.requestAnimationFrame(i.play),i.time.elapsed>i.time.fpsInterval&&(i.time.then=i.time.now-i.time.elapsed%i.time.fpsInterval,i.playHead=i.time.now-i.time.startTime,i.draw(i.playHead))):(i.playHead=i.playTime,i.goTo(1),i.pause())))},i.start=function(){i.playState=!0,i.play()},i.pause=function(){i.playState=!1},i.goTo=function(t){i.playTime>=t&&(i.playHead=t*i.playTime,i.draw(i.playHead)),i.pause()},i},SVIFT.vis.barchart=function(t,e){var i=SVIFT.vis.base(t,e);return i.d3config={ease:d3.easeBounce,xInterpolate:[],steps:t.data.data.length,showNumberLabels:t.data.showNumberLabels},i.setup=function(){i.d3config.barsContainer=i.vizContainer.selectAll("g").data(t.data.data).enter().append("g"),i.d3config.bars=i.d3config.barsContainer.append("rect").style("stroke","transparent").attr("class","visFill").style("opacity",0),i.d3config.barsText=i.d3config.barsContainer.append("text").text(function(t){var e="";return i.d3config.showNumberLabels&&(e=" ("+t.data[0]+")"),t.label+e}).attr("class","labelText").attr("font-size","1em").style("opacity",1),i.d3config.barsNumber=i.d3config.barsContainer.append("text").text(function(t){return t.data[0]}).attr("class","labelNumber").attr("text-anchor","middle").style("opacity",0),i.timeline={bars:{start:0,end:1500,func:i.barAnimation},text:{start:1500,end:3e3,func:i.textAnimation}}},i.update=function(){i.d3config.barsContainer.data(t.data.data).enter(),i.d3config.bars.datum(function(t){return t}),i.d3config.barsText.datum(function(t){return t}).text(function(t){return t.label})},i.resize=function(){var e=d3.max(t.data.data,function(t){return t.data[0]});i.d3config.y=d3.scaleBand().padding(.1).domain(t.data.data.map(function(t,e){return e})),i.d3config.x=d3.scaleLinear().domain([0,e]);var a=i.vizSize.height+20,n=i.vizSize.width;i.d3config.y.range([0,a]),i.d3config.x.range([n,0]),i.d3config.barsContainer.attr("transform","translate(0,"+i.d3config.y(0)+")"),i.d3config.bars.attr("y",function(t,e){return i.d3config.y(e)}).attr("height",i.d3config.y.bandwidth()).attr("opacity",0),t.data.data.forEach(function(t,e){i.d3config.xInterpolate[e]=d3.interpolate(0,n-i.d3config.x(t.data[0]))});var o=d3.interpolate(0,n-i.d3config.x(e))(1),r=i.d3config.barsText._groups[0][0].getBoundingClientRect().height;i.d3config.barsText.attr("x",function(t,e){return o/2>=i.d3config.xInterpolate[e](1)?i.d3config.xInterpolate[e](1)+10:i.d3config.xInterpolate[e](1)-10}).classed("white",function(t,e){return o/2>=i.d3config.xInterpolate[e](1)?!1:!0}).attr("y",function(t,e){return i.d3config.y(e)+i.d3config.y.bandwidth()/2+r/3}).attr("text-anchor",function(t,e){return o/2>=i.d3config.xInterpolate[e](1)?"start":"end"}).style("opacity",0),i.playHead==i.playTime&&(i.goTo(1),i.pause())},i.barAnimation=function(t){i.d3config.bars.style("opacity",1);for(var e=0;i.d3config.steps>e;e++)d3.select(i.d3config.bars._groups[0][e]).attr("width",function(){return i.d3config.xInterpolate[e](i.d3config.ease(t))})},i.textAnimation=function(t){0!==t&&i.d3config.barsText.style("opacity",1)},i};