var SVIFT={};SVIFT.helper={},SVIFT.helper.debouncer=function(t,e){var a,i=e||200;return function(){var e=this,n=arguments;clearTimeout(a),a=setTimeout(function(){t.apply(e,Array.prototype.slice.call(n))},i)}},SVIFT.helper.interpolate=function(t){var e,a={};for(a.def=t,a.interpolate=[],a.duration=0,e=1;a.def.length>e;e++)"ease"in a.def[e]||(a.def[e].ease=!1),a.interpolate.push(d3.interpolate(a.def[e-1].value,a.def[e].value)),a.duration+=a.def[e].duration;var i=0;for(e=1;a.def.length>e;e++)a.def[e].duration=a.def[e].duration/a.duration,a.def[e].start=i,i+=a.def[e].duration;return a.i=function(t){for(var e=1;a.def.length>e;e++)if(t>=a.def[e].start&&a.def[e].start+a.def[e].duration>=t)return a.def[e].ease?a.interpolate[e-1](a.def[e].ease((t-a.def[e].start)/a.def[e].duration)):a.interpolate[e-1]((t-a.def[e].start)/a.def[e].duration)},a.i},SVIFT.helper.switchCol=function(t,e,a){return t.forEach(function(t){var i=t[e];t[e]=t[a],t[a]=i}),t},SVIFT.helper.transpose=function(t){var e={};return t.forEach(function(t){for(var a in t)a in e||(e[a]=[])}),t.forEach(function(t){for(var a in e)a in t?e[a].push(t[a]):e[a].push(null)}),e},SVIFT.helper.cleanAxis=function(t){var e;e=t.attr("text-anchor")?t:t.select('g[text-anchor="*"]');var a=e.attr("text-anchor");e.selectAll("text").attr("text-anchor",a);var i=e.attr("font-size");e.selectAll("text").each(function(){var t=d3.select(this);["y","x"].forEach(function(e){var a=t.attr("d"+e);if(a){a.indexOf("em")>=0&&(a=parseFloat(a.substr(0,a.length-2))*i),t.attr("d"+e,0);var n=t.attr(e);n&&(a+=parseFloat(n)),t.attr(e,a)}})})},SVIFT.vis={},SVIFT.vis.base=function(t,e){var a={};return a.data=t,a.setData=function(t){a.data.data=t},a.container=e,a.g=null,a.svg=null,a.scale=!1,a.vizContainer=null,a.vizSize={width:500,height:500},a.vizInitSize={width:500,height:500},a.containerSize={width:0,height:0},a.theme=t.style.theme,a.color=t.style.color.main,a.custom=null,a.config={maxWidth:4096,maxHeight:4096,margin:{top:20,right:20,bottom:20,left:20},font:{sizes:{450:15,0:13},"default":"13px"},footerHeight:40,custom:!1},a.text={},a.timeline={},a.init=function(){a.scale=!1,a.vizInitSize.width=a.containerSize.width=a.container.node().offsetWidth,a.vizInitSize.height=a.containerSize.height=a.container.node().offsetHeight,a.vizSize.width=a.vizInitSize.width-a.config.margin.right-a.config.margin.left,a.vizSize.height=a.vizInitSize.height,a.svg=a.container.append("svg").attr("viewBox","0 0 "+a.containerSize.width+" "+a.containerSize.height).attr("class",a.theme+" "+a.color),a.defs=a.svg.append("defs"),a.g=a.svg.append("g").attr("transform","translate("+a.config.margin.top+","+a.config.margin.left+")"),a.custom=a.g.append("g"),a.data.custom&&(a.custom.attr("transform","translate("+(("left"==a.data.custom.logo.align?0:"right"==a.data.custom.logo.align?a.vizInitSize.width-a.config.margin.left-a.config.margin.right:a.vizInitSize.width/2-a.config.margin.left)+a.data.custom.logo.x_offset)+","+(("bottom"==a.data.custom.logo.valign?a.vizInitSize.height-(a.config.margin.bottom+a.config.margin.top):a.config.margin.top)+a.data.custom.logo.y_offset)+")"),a.custom.append("image").attr("xlink:href",a.data.custom.logo.url).attr("width",a.data.custom.logo.width).attr("height",a.data.custom.logo.height).attr("x","left"==a.data.custom.logo.align?0:"right"==a.data.custom.logo.align?-a.data.custom.logo.width:-a.data.custom.logo.width/2).attr("y","bottom"==a.data.custom.logo.valign?-a.data.custom.logo.height:0)),a.text.head=a.g.append("g").attr("class","title-wrapper"),a.text.title=a.text.head.append("text").attr("class","titleFont"),a.text.subtitle=a.text.head.append("text").attr("class","subtitleFont"),a.text.foot=a.g.append("g").attr("transform","translate(0,"+(a.containerSize.height-a.config.margin.bottom-a.config.margin.top)+")").attr("class","bottomTextWrapper"),a.text.attribution=a.text.foot.append("text").attr("x",a.containerSize.width-a.config.margin.left-a.config.margin.right).text(a.data.data.attribution).attr("class","attribution"),a.text.source=a.text.foot.append("text").text(a.data.data.source).attr("class","source"),a.vizContainer=a.g.append("g").attr("class","viz-container"),a.playHead=0,a.setup(),a.updateHead();for(var t in a.timeline){var e=a.timeline[t];e.end>a.playTime&&(a.playTime=e.end)}a.time.step=a.playTime/(a.playTime/1e3*a.time.fps),"function"==typeof window.callPhantom&&window.callPhantom({msg:"setupDone"}),d3.select(window).on("resize",SVIFT.helper.debouncer(function(){a.preResize(),a.scale||a.resize()},200))},a.updateHead=function(){var t=30,e=0,i=1.1,n=t;if(a.vizSize.width=a.vizInitSize.width-a.config.margin.left-a.config.margin.right,a.data.data.title.length>0){var o=a.data.data.title.split("\n");a.text.title.selectAll("tspan").remove(),o.forEach(function(e){for(var i=t,o=a.text.title.append("tspan").text(e).attr("x",0).style("font-size",i+"px");o.node().getComputedTextLength()>a.vizSize.width&&i>8;)i--,o.style("font-size",i+"px");n>i&&(n=i)}),a.text.title.attr("transform","translate(0,"+n+")"),a.text.title.selectAll("tspan").style("font-size",n+"px").attr("dy",function(t,e){return e>0?n*i:0}),e=n*i*(o.length-1)+n}var r=15,l=1.1,d=0,c=r>n?.75*n:r;a.data.data.subTitle.length>0&&(o=a.data.data.subTitle.split("\n"),a.text.subtitle.selectAll("tspan").remove(),o.forEach(function(t){for(var e=r,i=a.text.subtitle.append("tspan").text(t).attr("x",0).style("font-size",e+"px");i.node().getComputedTextLength()>a.vizSize.width&&e>5;)e--,i.style("font-size",e+"px");c>e&&(c=e)}),a.text.subtitle.selectAll("tspan").attr("dy",function(t,e){return e>0?c*l:0}).style("font-size",c+"px"),a.text.subtitle.attr("transform","translate(0,"+Math.round(e+1.55*c)+")"),d+=2*c+c*l*(o.length-1)),a.vizContainer.attr("transform","translate(0,"+(d+e)+")"),a.vizSize.height=a.vizInitSize.height-(d+e)-a.config.margin.top-a.config.margin.bottom-a.config.footerHeight-15,a.text.foot.attr("transform","translate(0,"+(a.vizInitSize.height-a.config.margin.bottom-a.config.margin.top)+")"),a.data.custom&&a.custom.attr("transform","translate("+(("left"==a.data.custom.logo.align?0:"right"==a.data.custom.logo.align?a.vizInitSize.width-a.config.margin.left-a.config.margin.right:a.vizInitSize.width/2-a.config.margin.left)+a.data.custom.logo.x_offset)+","+(("bottom"==a.data.custom.logo.valign?a.vizInitSize.height-(a.config.margin.bottom+a.config.margin.top):a.config.margin.top)+a.data.custom.logo.y_offset)+")"),a.text.attribution.attr("x",a.vizInitSize.width-a.config.margin.left-a.config.margin.right),a.updateSource(),a.resize()},a.setTheme=function(t){a.svg.classed(a.theme,!1),a.theme=t,a.svg.classed(a.theme,!0),a.updateHead()},a.setColor=function(t){a.svg.classed(a.color,!1),a.color=t,a.svg.classed(a.color,!0),a.updateHead()},a.updateSource=function(){a.text.source.text(a.data.data.source)},a.reset=function(){a.playState=!1,a.playHead=0,a.vizContainer.selectAll("*").remove(),a.setup(),a.resize()},a.process=function(){},a.setup=function(){},a.update=function(){},a.preResize=function(){a.containerSize.width=a.container.node().offsetWidth,a.containerSize.height=a.container.node().offsetHeight,a.scale||(a.svg.attr("viewBox","0 0 "+a.containerSize.width+" "+a.containerSize.height),a.vizInitSize.width=a.containerSize.width,a.vizInitSize.height=a.containerSize.height),a.updateHead()},a.setScale=function(t){a.scale=t},a.resize=function(){},a.draw=function(t){for(var e in a.timeline){var i=a.timeline[e];t>=i.start&&i.end>=t?i.func((t-i.start)/(i.end-i.start)):t>i.end?i.func(1):i.start>t&&i.func(0)}},a.playHead=0,a.playState=!1,a.playTime=0,a.time={fps:30,step:0,elapsed:0,fpsInterval:1e3/30,then:0,startTime:0,now:0},a.play=function(){a.playState&&("function"==typeof window.callPhantom?(a.playHead+=a.time.step,a.playTime>=a.playHead?(a.draw(a.playHead),window.callPhantom({msg:"drawDone",playHead:a.playHead})):(a.playHead=a.playTime,a.draw(a.playHead),a.pause(),window.callPhantom({msg:"playDone"}))):(0===a.time.then&&(a.time.then=a.time.startTime=Date.now()),a.time.now=Date.now(),a.time.elapsed=a.time.now-a.time.then,a.playTime>=a.time.now-a.time.startTime?(window.requestAnimationFrame(a.play),a.time.elapsed>a.time.fpsInterval&&(a.time.then=a.time.now-a.time.elapsed%a.time.fpsInterval,a.playHead=a.time.now-a.time.startTime,a.draw(a.playHead))):(a.playHead=a.playTime,a.goTo(1),a.pause())))},a.start=function(){a.playState=!0,a.play()},a.pause=function(){a.playState=!1},a.goTo=function(t){a.playTime>=t&&(a.playHead=t*a.playTime,a.draw(a.playHead)),a.pause()},a},SVIFT.vis.pie=function(t,e){var a=SVIFT.vis.base(t,e);return a.d3config={ease:d3.easeCubicInOut,easeExp:d3.easeExpIn,textInterpol:d3.interpolate(0,1),visPadding:15},a.setup=function(){a.d3config.pieContainer=a.vizContainer.append("g"),a.d3config.pie=d3.pie().value(function(t){return t.data[0]}).sort(null).padAngle(.1),a.d3config.pieContainer.datum(t.data.data).selectAll("path").data(a.d3config.pie).enter().append("g").classed("arcContainer",!0).append("path").attr("fill",function(e,a){return t.style.color.dataColors[a]}).attr("opacity",1).classed("arc",!0),a.d3config.pieText=d3.selectAll(".arcContainer").append("text")},a.process=function(){},a.update=function(){},a.resize=function(){var t=a.vizSize.width,e=a.vizSize.height;a.d3config.minSize=Math.min(t,e),console.log(t,e,a.d3config.minSize),a.d3config.pieContainer.attr("transform","translate("+t/2+","+e/2+")"),a.playHead==a.playTime&&(a.goTo(1),a.pause())},a.animatePie=function(t){var e=a.d3config.minSize/4,i=d3.interpolate(e,a.d3config.minSize/2-a.d3config.visPadding),n=i(a.d3config.ease(t));a.d3config.arc=d3.arc().innerRadius(e).outerRadius(n).cornerRadius(5),d3.selectAll(".arc").attr("d",a.d3config.arc)},a.animatetext=function(t){a.d3config.pieText.attr("transform",function(t){return"translate("+a.d3config.arc.centroid(t)+")"}).attr("dy",".35em").text(function(t){return t.data.label+" "+t.data.data[0]}).style("text-anchor","middle").style("fill","black").attr("class","labelText").attr("opacity",a.d3config.textInterpol(a.d3config.ease(t)))},a.timeline.pie={start:0,end:2e3,func:a.animatePie},a.timeline.text={start:2e3,end:3e3,func:a.animatetext},a};